<!DOCTYPE html>
<!-- Created by SÜHEYL SANATİ | ChatGPT Pro Enhanced -->
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1" />
  <title>Azot Dalış Merkezi – Hesap Kitaplar</title>
  <!-- Google Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --clr-primary-light:  #CAF0F8;
      --clr-primary:        #00A8E8;
      --clr-primary-dark:   #0077B6;
      --clr-accent:         #2E8B57;
      --clr-text:           #004d00;
      --clr-card-bg:        rgba(255, 255, 255, 0.15);
      --clr-btn-text:       var(--clr-text);
      --radius:             1rem;
      --spacing:            1.25rem;
      --shadow-soft:        0 8px 32px rgba(0,0,0,0.1);
      --transition:         0.3s cubic-bezier(.5,1.6,.4,1);
      --font:               'Poppins', sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; scroll-behavior: smooth; }
    body {
      font-family: var(--font);
      background: linear-gradient(135deg, rgba(202,240,248,0.7), rgba(0,119,182,0.7)),
                  url('https://www.whiteclouds.com/wp-content/uploads/2024/12/Top-10-Largest-Marine-Mammals-main-1024x585.jpg')
                    center center / cover no-repeat fixed;
      color: var(--clr-text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: var(--spacing) 0.5rem var(--spacing) 0.5rem;
      overflow-x: hidden;
      background-attachment: fixed;
    }
    html, body { width: 100%; max-width: 100vw; }
    .container {
      width: 100%;
      max-width: 1100px;
      background: var(--clr-card-bg);
      border-radius: var(--radius);
      padding: 2rem;
      box-shadow: var(--shadow-soft);
      backdrop-filter: saturate(180%) blur(20px);
      margin-bottom: 2rem;
      box-sizing: border-box;
      transition: box-shadow var(--transition);
    }
    header {
      text-align: center;
      margin-bottom: 2rem;
    }
    header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--clr-text);
      text-shadow: 1px 1px 4px rgba(0,0,0,0.2);
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.7rem;
      line-height: 1.2;
      word-break: break-word;
    }
    header p {
      font-size: 1.12rem;
      opacity: 0.85;
      margin-top: 0.3rem;
      letter-spacing: 0.01em;
    }
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px,1fr));
      gap: var(--spacing);
      margin-bottom: 2rem;
    }
    .field label {
      display: block;
      margin-bottom: 0.55rem;
      font-weight: 600;
      font-size: 0.98rem;
    }
    .field input,
    .field select {
      width: 100%;
      padding: 1rem 0.85rem;
      border: none;
      border-radius: var(--radius);
      background: rgba(255,255,255,0.25);
      backdrop-filter: blur(6px);
      font-size: 1rem;
      color: var(--clr-text);
      box-shadow: inset 0 4px 8px rgba(0,0,0,0.17);
      transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
      outline: none;
      appearance: none;
    }
    .field input::placeholder { color: rgba(0,77,0,0.62); }
    .field input:focus,
    .field select:focus {
      background: rgba(255,255,255,0.45);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 2px 8px rgba(44,142,87,0.15);
    }
    .field input[type="date"] {
      font-family: var(--font), Arial, sans-serif;
    }
    .actions {
      grid-column: 1 / -1;
      display: flex;
      gap: var(--spacing);
      margin-top: 0.5rem;
    }
    .btn {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: var(--radius);
      font-weight: 600;
      font-size: 1.06rem;
      cursor: pointer;
      background: linear-gradient(135deg, var(--clr-primary), var(--clr-accent));
      color: var(--clr-btn-text);
      box-shadow: 0 4px 16px rgba(0,0,0,0.22);
      transition: transform var(--transition), box-shadow var(--transition);
      outline: none;
      min-width: 44px;
      min-height: 44px;
    }
    .btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }
    .btn:not(:disabled):hover, .btn:focus-visible {
      transform: translateY(-3px) scale(1.03);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .btn--danger { background: #D32F2F; color: #fff; }
    .btn--small {
      padding: 0.4rem 0.75rem;
      font-size: 0.92rem;
      border-radius: 0.55rem;
      min-width: 40px; min-height: 40px;
    }
    section { margin-bottom: 2.2rem; }
    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      position: relative;
      display: inline-block;
    }
    h2::before {
      content: '';
      position: absolute;
      left: -1.2rem; top: 50%;
      transform: translateY(-50%);
      width: 4px; height: 100%;
      background: var(--clr-accent);
      border-radius: 2px;
    }
    .entries-list {
      list-style: none;
      display: grid;
      gap: 1rem;
      margin-bottom: 0.5rem;
      padding-left: 0;
    }
    .entries-list li {
      display: flex;
      justify-content: space-between;
      padding: 1rem 1.4rem;
      background: rgba(255,255,255,0.20);
      border-radius: var(--radius);
      backdrop-filter: blur(6px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.13) inset;
      font-weight: 500;
      font-size: 1rem;
    }
    .entries-total {
      text-align: right;
      font-size: 1.18rem;
      font-weight: 600;
      margin-top: 0.7rem;
    }
    .divers-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing);
      width: 100%;
    }
    .diver-card {
      background: rgba(255,255,255,0.22);
      border-radius: var(--radius);
      padding: var(--spacing);
      box-shadow: var(--shadow-soft);
      backdrop-filter: saturate(180%) blur(15px);
      transition: transform var(--transition), box-shadow var(--transition);
      min-width: 0;
      overflow-wrap: break-word;
      margin-bottom: 0.5rem;
    }
    .diver-card:hover, .diver-card:focus-within {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 12px 40px rgba(0,0,0,0.24);
    }
    .diver-card__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing);
      gap: 0.6rem;
      flex-wrap: wrap;
    }
    .diver-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .diver-card__icon {
      font-size: 1.45rem;
      color: var(--clr-accent);
    }
    .diver-card__name {
      font-size: 1.09rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      word-break: break-word;
    }
    .diver-card__actions {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .diver-card__date {
      font-size: 0.91rem;
      margin-left: 0.6rem;
      opacity: 0.78;
    }
    .diver-list {
      list-style: none;
      margin-bottom: var(--spacing);
      padding-left: 0;
    }
    .diver-list li {
      display: flex;
      justify-content: space-between;
      padding: 0.6rem 0;
      border-bottom: 1px dashed rgba(0,77,0,0.21);
      font-size: 0.98rem;
    }
    .diver-total {
      text-align: right;
      font-size: 1.1rem;
      font-weight: 600;
      margin-top: 0.2rem;
    }
    @media (max-width: 1000px) {
      .container { padding: 1.2rem; }
      .divers-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 600px) {
      .container { padding: 0.65rem; }
      form { grid-template-columns: 1fr; }
      .actions { flex-direction: column; gap: 0.7rem; }
      .btn { font-size: 0.98rem; padding: 0.85rem; }
      .entries-list li, .diver-card { padding: 0.85rem 0.75rem; }
      .divers-grid { grid-template-columns: 1fr; }
      .diver-card { padding: 1rem 0.7rem; }
      section { margin-bottom: 1.35rem; }
    }
    @media (max-width: 480px) {
      html, body { font-size: 15px; }
      body { background-attachment: scroll; }
      header h1 { font-size: clamp(1.1rem, 6vw, 1.65rem); }
      header p  { font-size: clamp(0.93rem, 3.7vw, 1.09rem); }
      .container { border-radius: 0.7rem; }
      .field input,
      .field select,
      .btn { font-size: 1rem; padding: 0.8rem; }
      .actions .btn { width: 100%; text-align: center; min-width: 44px; min-height: 44px; }
      .entries-list li,
      .diver-card { padding: 0.75rem 0.6rem; }
      .diver-card__actions { gap: 0.2rem; }
      .diver-card__date { margin-left: 0.15rem; font-size: 0.93rem;}
    }
    footer {
      text-align:center;
      font-size:0.93rem;
      color:var(--clr-text);
      margin-bottom:0.5rem;
      padding: 0.8rem 0 0.3rem 0;
      background:rgba(255,255,255,0.14);
      width:100vw;
      position: sticky;
      left: 0; bottom: 0; z-index: 10;
      border-radius: 0 0 1rem 1rem;
      backdrop-filter: blur(4px);
    }
    @media (max-width: 400px) {
      .container { padding: 0.35rem; }
      .diver-card, .entries-list li { font-size: 0.97rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fa-solid fa-person-diving"></i> Azot Dalış Merkezi</h1>
      <p>Hesap Kitaplar</p>
    </header>
    <main>
      <!-- INSTRUCTOR FIELD ADDED -->
      <form id="diveForm" autocomplete="off">
        <div class="field" style="grid-column:1/-1;">
          <label for="instructorName">Eğitmen Adı Soyadı</label>
          <input type="text" id="instructorName" maxlength="40" required placeholder="Eğitmen adı giriniz" autocapitalize="words" autocomplete="off" inputmode="text" />
        </div>
        <div class="field">
          <label for="diverName">Dalgıç Adı Soyadı</label>
          <input type="text" id="diverName" maxlength="40" required placeholder="Ad Soyad" autocapitalize="words" autocomplete="off" inputmode="text"/>
        </div>
        <div class="field">
          <label for="diveDate">Tarih</label>
          <input type="date" id="diveDate" required autocomplete="off"/>
        </div>
        <div class="field">
          <label for="diveType">Dalış Türü</label>
          <select id="diveType" required>
            <option value="" disabled selected hidden>Seçiniz…</option>
            <option value="Dx1">Deneme Dalışı – ₺600.00</option>
            <option value="Gx1">Bröveli Tek Dalışı – ₺400.00</option>
            <option value="Gx2">Bröveli Çoklu Dalışı (Dalış Başı) – ₺300.00</option>
            <option value="Gxg">Bröveli Grup Dalışı (Kişi Başı) – ₺300.00</option>
            <option value="Ex1">Bireysel Eğitim Dalışı – ₺600.00</option>
            <option value="Ex2">Grup Eğitim Dalışı (Kişi Başı) – ₺400.00</option>
          </select>
        </div>
        <div class="field">
          <label for="quantity">Adet</label>
          <input type="number" id="quantity" min="1" value="1" required autocomplete="off" inputmode="numeric"/>
        </div>
        <div class="actions">
          <button type="button" id="addBtn" class="btn">Ekle</button>
          <button type="button" id="clearAll" class="btn btn--danger">Temizle</button>
          <button type="button" id="completeLog" class="btn" disabled>Kaydı Tamamla</button>
        </div>
      </form>
      <section>
        <h2>Girişler</h2>
        <ul id="entryList" class="entries-list"></ul>
        <div id="total" class="entries-total">Toplam: ₺0.00</div>
      </section>
      <section>
        <h2>Kayıtlı Dalgıçlar</h2>
        <div id="diversPanel" class="divers-grid"></div>
      </section>
      <section>
        <h2>Genel Toplam</h2>
        <div id="overallTotal" class="entries-total">Genel Toplam: ₺0.00</div>
      </section>
      <!-- PDF EXPORT BUTTON ADDED -->
      <section style="text-align:right;margin-top:1.5rem;">
        <button type="button" id="exportPdfBtn" class="btn" style="width:auto;min-width:180px;">
          <i class="fa-solid fa-file-pdf"></i> PDF’ye Aktar / Paylaş
        </button>
      </section>
    </main>
  </div>
  <footer>
    Created by SÜHEYL SANATİ
  </footer>
  <script>
    const DIVE_TYPES = {
      Dx1: { label: 'Deneme Dalışı',                       price: 600 },
      Gx1: { label: 'Bröveli Tek Dalışı',                  price: 400 },
      Gx2: { label: 'Bröveli Çoklu Dalışı (Dalış Başı)',   price: 300 },
      Gxg: { label: 'Bröveli Grup Dalışı (Kişi Başı)',     price: 300 },
      Ex1: { label: 'Bireysel Eğitim Dalışı',              price: 600 },
      Ex2: { label: 'Grup Eğitim Dalışı (Kişi Başı)',      price: 400 },
    };
    const tln = n => `₺${n.toFixed(2)}`;
    const fmt = d => {
      if (!d) return '';
      const [y,m,day] = d.split('-');
      return `${day}/${m}/${y.slice(-2)}`;
    };

    const instructorEl= document.getElementById('instructorName');
    const nameEl      = document.getElementById('diverName');
    const dateEl      = document.getElementById('diveDate');
    const typeEl      = document.getElementById('diveType');
    const qtyEl       = document.getElementById('quantity');
    const entryList   = document.getElementById('entryList');
    const totalEl     = document.getElementById('total');
    const diversPanel = document.getElementById('diversPanel');
    const overallEl   = document.getElementById('overallTotal');
    const addBtn      = document.getElementById('addBtn');
    const clearBtn    = document.getElementById('clearAll');
    const finishBtn   = document.getElementById('completeLog');
    const exportPdfBtn= document.getElementById('exportPdfBtn');

    let entries = [];
    let divers  = [];
    let instructorName = '';

    function updateFinishBtn() {
      finishBtn.disabled = !(instructorEl.value.trim() && nameEl.value.trim() && dateEl.value && entries.length);
    }
    instructorEl.addEventListener('input', updateFinishBtn);
    nameEl.addEventListener('input', updateFinishBtn);
    dateEl.addEventListener('change', updateFinishBtn);

    function renderEntries() {
      entryList.innerHTML = entries.map(e => {
        const d = DIVE_TYPES[e.code];
        return `<li><span>${d.label} x ${e.qty}</span><span>${tln(d.price * e.qty)}</span></li>`;
      }).join('');
      const sum = entries.reduce((acc,e) => acc + DIVE_TYPES[e.code].price * e.qty, 0);
      totalEl.textContent = `Toplam: ${tln(sum)}`;
    }
    function renderDivers() {
      diversPanel.innerHTML = divers.map((dv,i) => `
        <div class="diver-card">
          <div class="diver-card__header">
            <div class="diver-info">
              <i class="fa-solid fa-person-diving diver-card__icon"></i>
              <span class="diver-card__name"> 
                🤿 ${dv.name}
              </span>
            </div>
            <div class="diver-card__actions">
              <button type="button" class="btn btn--small edit-diver" data-index="${i}" aria-label="Dalgıç Kaydını Düzenle">
                <i class="fa-solid fa-pen"></i>
              </button>
              <button type="button" class="btn btn--small delete-diver" data-index="${i}" aria-label="Dalgıç Kaydını Sil">
                <i class="fa-solid fa-trash"></i>
              </button>
              <span class="diver-card__date"> 📅 ${fmt(dv.date)}</span>
            </div>
          </div>
          <ul class="diver-list">
            ${dv.entries.map(e => {
              const dd = DIVE_TYPES[e.code];
              return `<li><span>${dd.label} x ${e.qty}</span><span>${tln(dd.price * e.qty)}</span></li>`;
            }).join('')}
          </ul>
          <div class="diver-total">Toplam: ${tln(dv.total)}</div>
        </div>
      `).join('');
      document.querySelectorAll('.edit-diver').forEach(btn =>
        btn.addEventListener('click', handleEdit)
      );
      document.querySelectorAll('.delete-diver').forEach(btn =>
        btn.addEventListener('click', handleDelete)
      );
    }
    function renderOverallTotal() {
      const grand = divers.reduce((acc, dv) => acc + dv.total, 0);
      overallEl.textContent = `Genel Toplam: ${tln(grand)}`;
    }
    function handleEdit(e) {
      const idx = +e.currentTarget.dataset.index;
      const dv  = divers[idx];
      divers.splice(idx, 1);
      nameEl.value   = dv.name;
      dateEl.value   = dv.date;
      entries         = dv.entries.map(x => ({ code: x.code, qty: x.qty }));
      renderEntries();
      renderDivers();
      renderOverallTotal();
      updateFinishBtn();
    }
    function handleDelete(e) {
      const idx = +e.currentTarget.dataset.index;
      if (confirm('Bu kaydı silmek istediğinize emin misiniz?')) {
        divers.splice(idx, 1);
        renderDivers();
        renderOverallTotal();
      }
    }
    addBtn.addEventListener('click', e => {
      e.preventDefault();
      if (!typeEl.value || qtyEl.value < 1) return;
      entries.push({ code: typeEl.value, qty: +qtyEl.value });
      renderEntries();
      updateFinishBtn();
      typeEl.selectedIndex = 0;
      qtyEl.value         = 1;
    });
    clearBtn.addEventListener('click', () => {
      if (!entries.length) return;
      if (confirm('Tüm dalışları silmek istiyor musunuz?')) {
        entries = [];
        renderEntries();
        updateFinishBtn();
      }
    });
    finishBtn.addEventListener('click', () => {
      if (!instructorEl.value.trim()) {
        alert('Lütfen eğitmen adını giriniz.');
        instructorEl.focus();
        return;
      }
      instructorName = instructorEl.value.trim();
      divers.push({
        name:    nameEl.value.trim(),
        date:    dateEl.value,
        entries: [...entries],
        total:   entries.reduce((a,e) => a + DIVE_TYPES[e.code].price * e.qty, 0)
      });
      entries            = [];
      renderEntries();
      renderDivers();
      renderOverallTotal();
      nameEl.value       = '';
      dateEl.value       = '';
      typeEl.selectedIndex = 0;
      qtyEl.value         = 1;
      updateFinishBtn();
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    });

    exportPdfBtn.addEventListener('click', () => {
      if (!instructorEl.value.trim()) {
        alert('PDF için önce eğitmen adını giriniz.');
        instructorEl.focus();
        return;
      }
      if (!divers.length) {
        alert('PDF’ye aktarılacak kayıt bulunamadı.');
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: "a4"
      });

      let y = 18;
      doc.setFont("helvetica","bold");
      doc.setFontSize(17);
      doc.text("Azot Dalış Merkezi - Günlük Dalış Raporu", 14, y);

      y += 10;
      doc.setFontSize(12);
      doc.setFont("helvetica","normal");
      doc.text("Eğitmen: " + instructorEl.value.trim(), 14, y);
      y += 8;
      doc.text("Tarih: " + (divers[0]?.date ? fmt(divers[0].date) : ""), 14, y);

      y += 7;
      doc.setFontSize(12);
      doc.setFont("helvetica","bold");
      doc.text("Kayıtlı Dalgıçlar:", 14, y);

      y += 6;
      divers.forEach((dv, i) => {
        doc.setFontSize(12);
        doc.setFont("helvetica","bold");
        doc.text(`${i+1}. ${dv.name} (${fmt(dv.date)})`, 16, y);
        y += 6;
        doc.setFont("helvetica","normal");
        dv.entries.forEach(e => {
          const label = DIVE_TYPES[e.code].label;
          const qty = e.qty;
          const price = DIVE_TYPES[e.code].price;
          doc.text(`- ${label} x ${qty}: ${tln(price * qty)}`, 20, y);
          y += 5;
        });
        doc.text(`Toplam: ${tln(dv.total)}`, 20, y);
        y += 7;
        if (y > 270) {
          doc.addPage();
          y = 18;
        }
      });
      y += 5;
      doc.setFontSize(13);
      doc.setFont("helvetica","bold");
      const genelToplam = divers.reduce((acc, dv) => acc + dv.total, 0);
      doc.text(`Genel Toplam: ${tln(genelToplam)}`, 14, y);

      const dateStr = (divers[0]?.date || "").replace(/-/g,"_");
      const instructor = instructorEl.value.trim().replace(/\s+/g, "_");
      doc.save(`daliskayit_${instructor}_${dateStr}.pdf`);

      if (navigator.canShare && navigator.canShare({ files: [] })) {
        doc.output('bloburl').then(url => {
          fetch(url).then(r=>r.blob()).then(blob => {
            const file = new File([blob], `daliskayit_${instructor}_${dateStr}.pdf`, { type: "application/pdf" });
            navigator.share({
              title: "Dalış Kayıt Raporu",
              text: "Günlük dalış kayıtları PDF olarak ektedir.",
              files: [file]
            }).catch(()=>{ });
          });
        });
      }
    });

    renderEntries();
    renderDivers();
    renderOverallTotal();
    updateFinishBtn();
  </script>
</body>
</html>
